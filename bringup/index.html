<html>
<head>
  <title>MARRtino bringup</title>
  <script src="../blockly/websocket_robot.js"></script>
</head>
<body>
<h1 align="center">MARRtino bringup</h1>

<hr>

<h1> Robot status </h1>

<table border=0>
    <tr height=40>
      <td>Robot IP</td>
<script>
      document.write("<td><input type=\"text\" name=\"IP\" id=\"IP\" value=\"" + 
            window.location.hostname + "\" width=240></td>")
</script>
      <td width=100><button onclick="connect()">Connect</button></td>
      <td width=120><button onclick="disconnect()">Disconnect</button></td>
      <td><div id="connection"><font color='red'>Not Connected</font></div></td>
    </tr>
    <tr height=40>
      <td>Status</td>
      <td><div id="status" style="color: blue;" >Idle</div></td>
    </tr>
</table>

<p>
ROS nodes:
<div id="rosnodes" style="color: blue;" ></div>
</p>

<p>
ROS topics:
<div id="rostopics" style="color: blue;" ></div>
</p>


<table border=1>
    <tr height=40>
      <td width=80><div id="ros" style="color: grey;" >ROS</div></td>
      <td width=80><div id="robot" style="color: grey;" >robot</div></td>
      <td width=80><div id="simrobot" style="color: grey;" >simrobot</div></td>
    </tr>
    <tr height=40>
      <td><div id="odom" style="color: grey;">odom</div></td>
      <td><div id="laser" style="color: grey;">laser</div></td>
    </tr>
    <tr height=40>
      <td><div id="rgb" style="color: grey;">RGB camera</div></td>
      <td><div id="depth" style="color: grey;">Depth camera</div></td>
    </tr>
</table>

<table>
  <tr><td>TF</td></tr>
  <tr><td><div id="tf_map_odom" style="color: grey;">map -&gt; odom</div></td></tr>
  <tr><td><div id="tf_odom_base" style="color: grey;">odom -&gt; base_frame</div></td></tr>

  <tr><td><div id="tf_base_laser" style="color: grey;">base_frame -&gt; laser_frame</div></td></tr>
  <tr><td><div id="tf_base_rgb" style="color: grey;">base_frame -&gt; rgb_camera_frame</div></td></tr>
  <tr><td><div id="tf_base_depth" style="color: grey;">base_frame -&gt; depth_camera_frame</div></td></tr>
</table>


<h1> Robot start-up actions </h1>

<p>
<button onclick="send_cmd('check')">Check status</button>
<button onclick="send_cmd('ros_quit')">Quit all</button>
</p>

<hr>

<p>
<button id="robot_start_btn" onclick="send_cmd('robot_start')">Robot start</button>
<button id="robot_quit_btn" onclick="send_cmd('robot_kill')">Robot quit</button>
<button id="simrobot_start_btn" onclick="send_cmd('simrobot_start')">Simrobot start</button>
<button id="simrobot_quit_btn" onclick="send_cmd('simrobot_kill')">Simrobot quit</button>
</p>

<hr>

<p>
<button id="usbcam_start_btn" onclick="send_cmd('usbcam_start')">USB camera start</button>
<button id="usbcam_quit_btn" onclick="send_cmd('usbcam_kill')">USB camera quit</button>
</p>

<p>
<button id="astra_start_btn" onclick="send_cmd('astra_start')">Astra camera start</button>
<button id="astra_quit_btn" onclick="send_cmd('astra_kill')">Astra camera quit</button>
</p>

<p>
<button id="xtion_start_btn" onclick="send_cmd('xtion_start')">Xtion camera start</button>
<button id="xtion_quit_btn" onclick="send_cmd('xtion_kill')">Xtion camera quit</button>
</p>

<hr>

<p>
<button id="hokuyo_start_btn" onclick="send_cmd('hokuyo_start')">Hokuyo laser start</button>
<button id="hokuyo_quit_btn" onclick="send_cmd('hokuyo_kill')">Hokuyo laser quit</button>
</p>

<p>
<button id="rplidar_start_btn" onclick="send_cmd('rplidar_start')">RPlidar laser start</button>
<button id="rplidar_quit_btn" onclick="send_cmd('rplidar_kill')">RPlidar laser quit</button>
</p>

<p>
<button id="astralaser_start_btn" onclick="send_cmd('astralaser_start')">Astra laser start</button>
<button id="astralaser_quit_btn" onclick="send_cmd('astralaser_kill')">Astra laser quit</button>
</p>

<p>
<button id="xtionlaser_start_btn" onclick="send_cmd('xtionlaser_start')">Xtion laser start</button>
<button id="xtionlaser_quit_btn" onclick="send_cmd('xtionlaser_kill')">Xtion laser quit</button>
</p>

<hr>

<p>
<button id="joystick_start_btn" onclick="send_cmd('joystick_start')">Joystick start</button>
<button id="joystick_quit_btn" onclick="send_cmd('joystick_kill')">Joystick quit</button>
</p>

<hr>

<p>
<button id="audio_start_btn" onclick="send_cmd('audio_start')">Audio start</button>
<button id="audio_quit_btn" onclick="send_cmd('audio_kill')">Audio quit</button>
<button id="wsrobot_start_btn" onclick="send_cmd('wsrobot_start')">WS robot start</button>
<button id="wsrobot_quit_btn" onclick="send_cmd('wsrobot_kill')">WS robot quit</button>
</p>

<hr>


<br><br><br>

</body>


<!-- ****** SCRIPTS ****** -->

<script>

    //document.getElementById("simrobot_start_btn").disabled = false;

    // messages received from wsserver
    eventproc = function(event){
      v = event.data.split(' ');

      if (v[0]=='STATUS') {
          document.getElementById("status").innerHTML = v[1];
      }
      else if (v[0]=='RESULT') {
          cv = v[2];
          if (v[2]=='True') {
            cv = "<font color='green'>"+v[2]+"</font>"
            document.getElementById(v[1]).style.color = 'green';
            document.getElementById(v[1]+"_btn").style.color = 'green';

            //document.getElementById(v[1]+"_start_btn").disabled = false;
            //document.getElementById(v[1]+"_quit_btn").disabled = false;
          }
          else if (v[2]=='False') {
            cv = "<font color='red'>"+v[2]+"</font>"
            document.getElementById(v[1]).style.color = 'red';
            //document.getElementById(v[1]+"_start_btn").disabled = false;
            //document.getElementById(v[1]+"_quit_btn").disabled = false;
          }
      }
      else if (v[0]=='VALUE') {
          vs = '';
          for (i=2; i<v.length ; i++)
             vs += v[i]
          document.getElementById(v[1]).innerHTML = vs;
      }
    }

    function connect() {
        wsrobot_init(9500);  // init websocket robot
        setTimeout(check_connection, 1000);
        websocket.onmessage = eventproc;
    }

    function disconnect() {
        wsrobot_quit();  // init websocket robot
        setTimeout(check_connection, 1000);
    }

    function check_connection() {
        console.log("check connection")
        if (wsrobot_connected()) {
            console.log("wsrobot_connected true")
            document.getElementById("connection").innerHTML = "<font color='green'>Connected</font>";
            //document.getElementById("run_btn").disabled = false;
            //document.getElementById("stop_btn").disabled = false;
        }
        else {
            console.log("wsrobot_connected false")
            document.getElementById("connection").innerHTML = "<font color='red'>Not Connected</font>";
            //document.getElementById("run_btn").disabled = true;
            //document.getElementById("stop_btn").disabled = true;
        }
    }

    function send_cmd(action) {
        wsrobot_send(action);
    }

 


</script>

</html>

